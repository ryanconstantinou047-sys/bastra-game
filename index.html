<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Basra â€“ 2 Player Card Game</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0b5d1e;
      color: white;
      margin: 0;
      padding: 0;
    }

    h1 {
      text-align: center;
      margin: 10px 0;
    }

    .game {
      display: grid;
      grid-template-rows: auto auto 1fr auto;
      height: 100vh;
    }

    .hand {
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 15px;
    }

    .table {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      padding: 20px;
      background: #146b2e;
      border-top: 2px solid #0a3d1a;
      border-bottom: 2px solid #0a3d1a;
    }

    .card {
      width: 60px;
      height: 90px;
      background: white;
      color: black;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
    }

    .card.red {
      color: darkred;
    }

    .disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    .info {
      text-align: center;
      padding: 10px;
      background: #083516;
    }
  </style>
</head>

<body>
<div class="game">
  <h1>Basra</h1>

  <div id="player2" class="hand"></div>

  <div id="table" class="table"></div>

  <div id="player1" class="hand"></div>

  <div class="info" id="info"></div>
</div>

<script>
/* ---------------- GAME DATA ---------------- */

const suits = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
const values = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];

let deck = [];
let tableCards = [];

let players = [
  { hand: [], captured: [], score: 0 },
  { hand: [], captured: [], score: 0 }
];

let currentPlayer = 0;

/* ---------------- SETUP ---------------- */

function createDeck() {
  deck = [];
  for (let s of suits) {
    for (let v of values) {
      deck.push({ suit: s, value: v });
    }
  }
}

function shuffle(deck) {
  for (let i = deck.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [deck[i], deck[j]] = [deck[j], deck[i]];
  }
}

function dealInitial() {
  for (let i = 0; i < 4; i++) {
    players[0].hand.push(deck.pop());
    players[1].hand.push(deck.pop());
    tableCards.push(deck.pop());
  }
}

/* ---------------- HELPERS ---------------- */

function cardValue(card) {
  if (card.value === 'A') return 1;
  if (['J','Q','K'].includes(card.value)) return card.value;
  return parseInt(card.value);
}

function isRed(card) {
  return card.suit === 'â™¥' || card.suit === 'â™¦';
}

/* ---------------- GAMEPLAY ---------------- */

function playCard(playerIndex, cardIndex) {
  if (playerIndex !== currentPlayer) return;

  const card = players[playerIndex].hand.splice(cardIndex, 1)[0];
  let captured = [];

  // ONLY JACK CAPTURES ALL
  if (card.value === 'J') {
    captured = tableCards.splice(0);
  } else {
    // Match value only
    for (let i = tableCards.length - 1; i >= 0; i--) {
      if (cardValue(tableCards[i]) === cardValue(card)) {
        captured.push(...tableCards.splice(i, 1));
        break;
      }
    }
  }

  if (captured.length > 0) {
    players[playerIndex].captured.push(card, ...captured);

    // BASRA (not with Jack)
    if (tableCards.length === 0 && card.value !== 'J') {
      players[playerIndex].score += 10;
      info.textContent = `Player ${playerIndex + 1} scored a BASRA!`;
    }
  } else {
    tableCards.push(card);
  }

  endTurn();
}

function endTurn() {
  if (
    players[0].hand.length === 0 &&
    players[1].hand.length === 0 &&
    deck.length > 0
  ) {
    for (let i = 0; i < 4; i++) {
      players[0].hand.push(deck.pop());
      players[1].hand.push(deck.pop());
    }
  }

  currentPlayer = 1 - currentPlayer;
  render();
}

/* ---------------- RENDERING ---------------- */

function render() {
  const p1 = document.getElementById('player1');
  const p2 = document.getElementById('player2');
  const table = document.getElementById('table');
  const info = document.getElementById('info');

  p1.innerHTML = '';
  p2.innerHTML = '';
  table.innerHTML = '';

  players[0].hand.forEach((card, i) => {
    const el = createCard(card, () => playCard(0, i));
    if (currentPlayer !== 0) el.classList.add('disabled');
    p1.appendChild(el);
  });

  players[1].hand.forEach(() => {
    const el = createCard({ value: 'ðŸ‚ ', suit: '' });
    p2.appendChild(el);
  });

  tableCards.forEach(card => table.appendChild(createCard(card)));

  info.textContent = `Player ${currentPlayer + 1}'s turn`;
}

function createCard(card, onClick) {
  const div = document.createElement('div');
  div.className = 'card';
  if (isRed(card)) div.classList.add('red');
  div.textContent = `${card.value}${card.suit}`;
  if (onClick) div.onclick = onClick;
  return div;
}

/* ---------------- START GAME ---------------- */

createDeck();
shuffle(deck);
dealInitial();
render();
</script>
</body>
</html>
